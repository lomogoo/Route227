<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unified Feed & Stamp</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <!-- App Loader (初期は active。JSで解除) -->
  <div id="app-loader" class="app-loader active" aria-live="polite" aria-busy="true">
    <div class="loader" role="status" aria-label="読み込み中"></div>
  </div>

  <!-- スクリーンリーダー向けライブリージョン -->
  <div id="sr-live" aria-live="polite" style="position:absolute;left:-9999px;"></div>

  <!-- Header -->
  <header class="app-header">
    <div class="header-container container">
      <div class="header-title">
        <div class="brand-icon" aria-hidden="true"></div>
        <div>
          <div style="font-weight:800; letter-spacing:.02em;">Route227</div>
          <small class="text-muted">Unified Feed / Stamp</small>
        </div>
      </div>
      <div id="user-status" class="flex"></div>
    </div>
  </header>

  <!-- Main -->
  <main class="app-content">
    <!-- Feed Section -->
    <section id="feed-section" class="section active">
      <div class="container">
        <div id="category-tabs" class="category-tabs" role="tablist" aria-label="カテゴリ">
          <button class="category-tab active" data-category="all" role="tab" aria-selected="true">すべて</button>
          <button class="category-tab" data-category="news" role="tab">お知らせ</button>
          <button class="category-tab" data-category="event" role="tab">イベント</button>
          <button class="category-tab" data-category="misc" role="tab">その他</button>
        </div>

        <div id="articles-container" class="articles-container" aria-live="polite"></div>
        <div class="center">
          <button id="load-more-btn" class="btn" style="display:inline-flex; align-items:center; gap:6px;">もっと見る</button>
        </div>
      </div>
    </section>

    <!-- Stamp / Foodtruck Section -->
    <section id="foodtruck-section" class="section">
      <div class="container">
        <div class="card">
          <div class="card-header"><strong>今日の出店情報</strong></div>
          <div id="today-vendors" class="card-body">
            <div class="text-muted">読み込み中…</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><strong>出店スケジュール</strong></div>
          <div id="vendor-schedule" class="card-body">
            <div class="text-muted">読み込み中…</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header space-between flex"><strong>スタンプカード</strong>
            <div class="flex">
              <button id="scan-qr" class="btn">QRスキャン</button>
              <button id="coffee-reward" class="btn">コーヒー特典</button>
              <button id="curry-reward" class="btn">カレー特典</button>
            </div>
          </div>
          <div class="card-body">
            <div class="stamp-grid" id="stamp-grid"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><strong>特典履歴</strong></div>
          <div id="reward-history" class="card-body">
            <div class="text-muted">履歴はまだありません</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Rank Section -->
    <section id="rank-section" class="section">
      <div class="container">
        <div class="card">
          <div class="card-header"><strong>ランキング</strong></div>
          <div class="card-body">
            <ol id="rank-list" class="rank-list"></ol>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer Navigation -->
  <nav class="footer-nav" aria-label="メインナビゲーション">
    <button class="nav-link active" data-section="feed-section" aria-label="フィード">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 12h16M4 6h16M4 18h16"/></svg>
      フィード
    </button>
    <button class="nav-link" data-section="foodtruck-section" aria-label="スタンプ">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="4"/><path d="M4 12a8 8 0 1 0 16 0"/></svg>
      スタンプ
    </button>
    <button class="nav-link" data-section="rank-section" aria-label="ランク">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 21V10M16 21V3M12 21v-6"/></svg>
      ランク
    </button>
  </nav>

  <!-- Toast -->
  <div id="toast-notification" class="toast" role="status" aria-live="polite"></div>

  <!-- Login Modal -->
  <div id="login-modal" class="modal" aria-hidden="true" aria-labelledby="login-title">
    <div class="modal-content">
      <div class="modal-header space-between flex">
        <strong id="login-title">ログイン</strong>
        <button class="btn close-modal" aria-label="閉じる">×</button>
      </div>
      <div class="modal-body">
        <div class="auth-step active" id="login-step">
          <label for="login-email">メールアドレス</label>
          <input id="login-email" class="input" type="email" placeholder="you@example.com" />
          <div class="mt-2"></div>
          <label for="login-password">パスワード</label>
          <input id="login-password" class="input" type="password" />
          <div class="mt-3"></div>
          <button id="login-submit" class="btn primary" style="width:100%;">ログイン</button>
        </div>
        <div class="auth-step" id="message-step" aria-live="polite">
          <p id="message-text">メッセージ</p>
        </div>
      </div>
      <div class="modal-footer center">
        <button class="btn modal-ok-btn">OK</button>
      </div>
    </div>
  </div>

  <!-- Welcome Modal -->
  <div id="welcome-modal" class="modal" aria-hidden="true" aria-labelledby="welcome-title">
    <div class="modal-content">
      <div class="modal-header space-between flex">
        <strong id="welcome-title">ようこそ</strong>
        <button class="btn close-modal" aria-label="閉じる">×</button>
      </div>
      <div class="modal-body">
        <p>はじめてのご利用ありがとうございます。フィードやスタンプをお楽しみください。</p>
      </div>
      <div class="modal-footer center">
        <button class="btn modal-ok-btn">OK</button>
      </div>
    </div>
  </div>

  <!-- 必要なら、Supabase の設定を index.html 側でグローバルに持たせてください（例） -->
  <!--
  <script>
    window.SUPABASE_URL = "https://xxxxxxxx.supabase.co";
    window.SUPABASE_ANON_KEY = "xxxxxxxxxxxxxxxxxxxxxxxx";
  </script>
  -->

  <!-- あなたの環境で supabase-js を読み込んでいる場合はそのままにしてください -->
  <!-- <script src="https://unpkg.com/@supabase/supabase-js@2"></script> -->

  <script src="./app.js"></script>
</body>
</html>
